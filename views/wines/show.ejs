<%- include('../partials/header') %>

<h1><%= wine.name %></h1>

<section id="wine-top">
    <div id="wine-type">
        <div class="label-d button-label">
            <p class="label-p raleway-bold">Type</p>
            <a href="/wines/<%= wine._id %>/types"><button>Edit</button></a>
        </div>
        <div class="value-d">
            <% if (wine.type) { %> 
                <p class="value-p"><%= wine.type.name %></p>
            <% } %>
        </div>
    </div>
    <div id="wine-maker">
        <div class="label-d button-label">
            <p class="label-p raleway-bold">Maker</p>
            <a href="/wines/<%= wine._id %>/makers"><button>Edit</button></a>
        </div>
        <div class="value-d">
            <% if (wine.maker) { %> 
                <p class="value-p"><%= wine.maker.name %></p>
                <% } %>
            </div>
        </div>
        <div id="wine-rating">
            <div class="label-d" id="my-rating">
                <p class="label-p raleway-bold">My Rating</p>
            </div>
            <div class="value-d" id="avg-rating">
                <% if (rating > 0) { %> 
                    <p class="value-p"><%= rating %></p>
                <% } %>
            </div>
        </div>
</section>

<section>
    <div class="label-d, button-label">
        <p class="label-p, raleway-bold">Vendors</p>
        <a href="/wines/<%= wine._id %>/vendors"><button class="multi-button">Edit</button></a>
    </div>
    <div class="value-d, multi">
        <% if (wine.vendors.length) { %> 
            <% vendors.forEach(function(v) { %>
                <div class="vendor">
            <p class="value-p"><%= v.name %></p>
                </div>
        <% }) %>
        <% } %>
    </div>
</section><br>




<section>
    <div class="label-d button-label">
        <p class="label-p, raleway-bold">Notes</p>
        <a href="/wines/<%= wine._id %>/notes/new"><button class="multi-button">New Note</button></a>
    </div>
    <div class="notes-container">
        <% if (notes) { %> 
            <% notes.forEach(function(n) { %>
            <div class="note value-d">
                <div class="note-header">
                    <div class="date raleway">
                        <% const created = n.createdAt.toLocaleDateString('en-us', { year:"numeric", month:"long", day:"numeric"}) %>
                        <%= n.createdAt.toLocaleDateString('en-us', { year:"numeric", month:"long", day:"numeric"}) %>
                    </div>
                    <a href="<%- `/notes/${n._id}/edit` %>"><button class="light-button">Edit</button></a>
                </div>
                <% const updated = n.updatedAt.toLocaleDateString('en-us', { year:"numeric", month:"long", day:"numeric"}) %>
                <% if (updated !== created) {%>
                <div class="updated raleway small">
                    updated <%= n.updatedAt.toLocaleDateString('en-us', { year:"numeric", month:"long", day:"numeric"}) %>
                </div>
                <% } %>

                <div class="note-mid">
                    <div class="vintage">
                        <span class="raleway">Vintage: </span><%= n.vintage %>
                    </div>

                    <div class="rating">
                        <span class="raleway">Rating: </span><%= n.rating %>
                    </div>
                </div>

                <div class="body">
                    <%= n.body %>
                </div>
            </div>
            <% }) %>
        <% } %>
    </div>
</section><br>

<a href="/wines/<%= wine._id %>/delete"><button class="large-button">Delete This Wine</button></a>
</form>
<br>
<br>
<a href="/wines/<%= wine._id %>/edit"><button class="large-button">Change Name</button></a>
</form>

<%- include('../partials/footer') %>